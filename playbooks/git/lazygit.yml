---
- name: Install lazygit
  hosts: all
  tasks:
    - name: Download latest release metadata
      uri:
        url: https://api.github.com/repos/jesseduffield/lazygit/releases/latest
        return_content: yes
      register: lazygit_latest_version_metadata
    - name: Parse latest version tag
      set_fact:
        lazygit_latest_version: "{{ lazygit_latest_version_metadata.json.tag_name | regex_replace('^v', '') }}"
    - name: Download lazygit
      get_url:
        url: "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_{{ lazygit_latest_version }}_Linux_x86_64.tar.gz"
        dest: /tmp/lazygit.tar.gz
    - name: Unpack lazygit
      shell: tar xf /tmp/lazygit.tar.gz lazygit
    - name: Make lazygit executable
      file:
        path: /tmp/lazygit
        mode: 0700
    - name: Move lazygit to /usr/local/bin
      become: true
      shell: mv lazygit /usr/local/bin/lazygit
