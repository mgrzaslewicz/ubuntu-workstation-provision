---
- name: Install JDKs
  hosts: all
  gather_facts: False
  tags: java,jvm
  tasks:
    - name: Find mise binary path
      shell: command -v mise || echo ~/.local/bin/mise
      register: mise_path
      changed_when: false
    - name: Install JDK versions with mise
      shell: "{{ mise_path.stdout }} install java@{{ item }}"
      register: mise_install
      changed_when: "'installed' in mise_install.stdout or 'installing' in mise_install.stdout"
      loop:
        - 17
        - 21
        - 25
    - name: Set latest JDK (25) as global default
      shell: "{{ mise_path.stdout }} use --global java@25"
    - name: Allow idiomatic java usage
      shell: "{{ mise_path.stdout }} settings add idiomatic_version_file_enable_tools java"
      changed_when: false
